{"version":3,"sources":["tangojs-connector-local.min.js","/source/tangojs-connector-local.js"],"names":["global","factory","define","amd","exports","require","mod","tangojs","tangojsConnectorLocal","this","_tangojs","_classCallCheck","instance","Constructor","TypeError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","now","Date","getTime","reject","message","Promise","Error","defineProperty","_slicedToArray","sliceIterator","arr","i","_arr","_n","_d","_e","undefined","_s","_i","Symbol","iterator","next","done","push","length","err","Array","isArray","_createClass","defineProperties","target","props","descriptor","key","protoProps","staticProps","_get","_x3","_x4","_x5","_again","object","property","receiver","desc","parent","getter","Function","getOwnPropertyDescriptor","get","call","getPrototypeOf","LocalConnector","_tangojs$Connector","model","_model","name","_name$split","split","_name$split2","domain","family","member","resolve","error","deviceName","attributeName","_devicePromise","then","device","attributes","commandName","commands","keys","_device$status","status","_device$status2","state","DeviceStatusResponse","DeviceInfo","info","_attributePromise","attribute","AttributeReadResponse","read","AttributeQuality","ATTR_VALID","nameValuePairs","_this","sync","arguments","reset","attributeValuePairsPromises","map","_ref","_ref2","attr","quality","writeAttributeValuePairs","attributeValuePairs","_ref3","_ref32","write","_ref4","_ref42","changedNames","_ref5","_ref52","n","resetUnspecifiedIfRequired","readResponses","readAttributesList","allNames","nonChangedAttributePromises","filter","all","attrs","forEach","a","x","AttributeInfo","_commandPromise","command","CommandInfo","arg","result","execute","CommandOutputResponse","Connector"],"mappings":"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","file":"tangojs-connector-local.min.js","sourcesContent":["!function(e,t){if(\"function\"==typeof define&&define.amd)define([\"exports\",\"tangojs\"],t);else if(\"undefined\"!=typeof exports)t(exports,require(\"tangojs\"));else{var n={exports:{}};t(n.exports,e.tangojs),e.tangojsConnectorLocal=n.exports}}(this,function(e,t){\"use strict\";function n(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function r(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(){return(new Date).getTime()}function i(e){return Promise.reject(new Error(e))}Object.defineProperty(e,\"__esModule\",{value:!0});var u=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&a[\"return\"]&&a[\"return\"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,u=n;a=c=s=void 0,r=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if(\"value\"in a)return a.value;var s=a.get;return void 0===s?void 0:s.call(u)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=u,r=!0}},c=function(e){function c(e){n(this,c),s(Object.getPrototypeOf(c.prototype),\"constructor\",this).call(this),this._model=e}return r(c,e),a(c,[{key:\"_devicePromise\",value:function(e){try{var t=e.split(\"/\"),n=u(t,3),r=n[0],o=n[1],a=n[2];return Promise.resolve(this._model[r][o][a])}catch(s){return i(\"Invalid device name: '\"+e+\"'\")}}},{key:\"_attributePromise\",value:function(e,t){return this._devicePromise(e).then(function(n){return n.attributes&&n.attributes[t]?n.attributes[t]:i(\"Attribute not found: '\"+e+\"/\"+t+\"'\")})}},{key:\"_commandPromise\",value:function(e,t){return this._devicePromise(e).then(function(n){return n.commands&&n.commands[t]?n.commands[t]:i(\"Command not found: '\"+e+\"/\"+t+\"'\")})}},{key:\"dbReadDomains\",value:function(){return this._model?Promise.resolve(Object.keys(this._model)):Promise.reject(new Error(\"Invalid model\"))}},{key:\"dbReadFamilies\",value:function(e){return this._model&&this._model[e]?Promise.resolve(Object.keys(this._model[e])):Promise.reject(new Error(\"Invalid domain: '\"+e+\"'\"))}},{key:\"dbReadMembers\",value:function(e,t){return this._model&&this._model[e]&&this._model[e][t]?Promise.resolve(Object.keys(this._model[e][t])):Promise.reject(new Error(\"Invalid domain: '\"+e+\"' or family: '\"+t+\"'\"))}},{key:\"readDeviceStatus\",value:function(e){return this._devicePromise(e).then(function(e){var n=e.status(),r=u(n,2),i=r[0],a=r[1];return new t.DeviceStatusResponse(o(),i,a)})}},{key:\"readDeviceInfo\",value:function(e){return this._devicePromise(e).then(function(e){return new t.DeviceInfo(e.info())})}},{key:\"readAttributesList\",value:function(e){return this._devicePromise(e).then(function(e){return Object.keys(e.attributes)})}},{key:\"readAttributeValue\",value:function(e,n){return this._attributePromise(e,n).then(function(e){return new t.AttributeReadResponse(o(),e.read(),t.AttributeQuality.ATTR_VALID)})}},{key:\"writeAttributeValuesBulk\",value:function(e,n){var r=this,i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],a=arguments.length<=3||void 0===arguments[3]?!1:arguments[3],s=n.map(function(t){var n=u(t,2),o=n[0],i=n[1];return r._attributePromise(e,o).then(function(e){return[e,i]})}),c=t.AttributeQuality.ATTR_VALID,f=function(e){return e.map(function(e){var t=u(e,2),n=t[0],r=t[1];return[n,n.write(r)]}).map(function(e){var n=u(e,1),r=n[0];return i?new t.AttributeReadResponse(o(),r.read(),c):void 0})},l=n.map(function(e){var t=u(e,1),n=t[0];return n}),m=a?function(t){return r.readAttributesList(e).then(function(n){var o=n.filter(function(e){return!(e in l)}).map(function(t){return r._attributePromise(e,t)});return Promise.all(o).then(function(e){return e.forEach(function(e){return e.reset()})}).then(function(){return t})})}:function(e){return e};return Promise.all(s).then(f).then(m)}},{key:\"readAttributeInfo\",value:function(e,n){return this._attributePromise(e,n).then(function(e){return new t.AttributeInfo(e.info())})}},{key:\"readCommandsList\",value:function(e){return this._devicePromise(e).then(function(e){return Object.keys(e.commands)})}},{key:\"readCommandInfo\",value:function(e,n){return this._commandPromise(e,n).then(function(e){return new t.CommandInfo(e.info())})}},{key:\"executeCommand\",value:function(e,n,r,i){return this._commandPromise(e,n).then(function(e){var n=e.execute(r);return i?new t.CommandOutputResponse(o(),n):void 0})}}]),c}(t.Connector);e.LocalConnector=c});\n//# sourceMappingURL=tangojs-connector-local.min.js.map","\n// FIXME '* as' should not be there\n// https://github.com/babel/babel/issues/95\n\nimport * as tangojs from 'tangojs'\n\n/** @private */\nfunction now() {\n  return (new Date()).getTime()\n}\n\n/** @private */\nfunction reject(message) {\n  return Promise.reject(new Error(message))\n}\n\n/**\n * In-memory connector implementation.\n */\nexport class LocalConnector extends tangojs.Connector {\n\n  /**\n   * @param {Object} data model\n   */\n  constructor(model) {\n    super()\n    /** @private */\n    this._model = model\n  }\n\n  /** @private */\n  _devicePromise(name) {\n    try {\n      let [domain, family, member] = name.split('/')\n      return Promise.resolve(this._model[domain][family][member])\n    } catch (error) {\n      return reject(`Invalid device name: '${name}'`)\n    }\n  }\n\n  /** @private */\n  _attributePromise(deviceName, attributeName) {\n    return this._devicePromise(deviceName).then(device =>\n      device.attributes && device.attributes[attributeName]\n        ? device.attributes[attributeName]\n        : reject(`Attribute not found: '${deviceName}/${attributeName}'`)\n    )\n  }\n\n  /** @private */\n  _commandPromise(deviceName, commandName) {\n    return this._devicePromise(deviceName).then(device =>\n      device.commands && device.commands[commandName]\n        ? device.commands[commandName]\n        : reject(`Command not found: '${deviceName}/${commandName}'`)\n    )\n  }\n\n  // --- tangojs.Connector implementation starts here ---\n\n  dbReadDomains() {\n    return this._model\n      ? Promise.resolve(Object.keys(this._model))\n      : Promise.reject(new Error('Invalid model'))\n  }\n\n  dbReadFamilies(domain) {\n    return this._model && this._model[domain]\n      ? Promise.resolve(Object.keys(this._model[domain]))\n      : Promise.reject(new Error(`Invalid domain: '${domain}'`))\n  }\n\n  dbReadMembers(domain, family) {\n    return this._model && this._model[domain] && this._model[domain][family]\n      ? Promise.resolve(Object.keys(this._model[domain][family]))\n      : Promise.reject(\n          new Error(`Invalid domain: '${domain}' or family: '${family}'`))\n  }\n\n  readDeviceStatus(deviceName) {\n    return this._devicePromise(deviceName).then(device => {\n      let [state, status] = device.status()\n      return new tangojs.DeviceStatusResponse(now(), state, status)\n    })\n  }\n\n  readDeviceInfo(deviceName) {\n    return this._devicePromise(deviceName).then(device =>\n      new tangojs.DeviceInfo(device.info())\n    )\n  }\n\n  readAttributesList(deviceName) {\n    return this._devicePromise(deviceName).then(device =>\n      Object.keys(device.attributes)\n    )\n  }\n\n  readAttributeValue(deviceName, attributeName) {\n    return this._attributePromise(deviceName, attributeName).then(attribute =>\n      new tangojs.AttributeReadResponse(now(), attribute.read(),\n        tangojs.AttributeQuality.ATTR_VALID)\n    )\n  }\n\n  writeAttributeValuesBulk(deviceName, nameValuePairs, sync = false,\n    reset = false) {\n\n    // attribute objects paired with values to write\n    let attributeValuePairsPromises = nameValuePairs.map(([name, value]) =>\n      this._attributePromise(deviceName, name).then(attr => [attr, value])\n    )\n\n    let quality = tangojs.AttributeQuality.ATTR_VALID\n\n    // write values and read stored results (if required)\n    let writeAttributeValuePairs = attributeValuePairs => attributeValuePairs\n      .map(([attr, value]) => [attr, attr.write(value)])\n      .map(([attr]) => sync\n        ? new tangojs.AttributeReadResponse(now(), attr.read(), quality)\n        : undefined\n      )\n\n    let changedNames = nameValuePairs.map(([n]) => n)\n\n    // reset parameters if required\n    let resetUnspecifiedIfRequired = (! reset)\n      ? (x => x)\n      : readResponses => this.readAttributesList(deviceName).then(allNames => {\n          let nonChangedAttributePromises = allNames\n            .filter(name => !(name in changedNames))\n            .map(name => this._attributePromise(deviceName, name))\n          return Promise.all(nonChangedAttributePromises)\n            .then(attrs => attrs.forEach(a => a.reset()))\n            .then(() => readResponses)\n        })\n\n    return Promise.all(attributeValuePairsPromises)\n      .then(writeAttributeValuePairs)\n      .then(resetUnspecifiedIfRequired)\n  }\n\n  readAttributeInfo(deviceName, attributeName) {\n    return this._attributePromise(deviceName, attributeName).then(attribute =>\n      new tangojs.AttributeInfo(attribute.info())\n    )\n  }\n\n  readCommandsList(deviceName) {\n    return this._devicePromise(deviceName).then(device =>\n      Object.keys(device.commands)\n    )\n  }\n\n  readCommandInfo(deviceName, commandName) {\n    return this._commandPromise(deviceName, commandName).then(command =>\n      new tangojs.CommandInfo(command.info())\n    )\n  }\n\n  executeCommand(deviceName, commandName, arg, sync) {\n    return this._commandPromise(deviceName, commandName).then(command => {\n      let result = command.execute(arg)\n      return sync\n        ? new tangojs.CommandOutputResponse(now(), result)\n        : undefined\n    })\n  }\n}\n"],"sourceRoot":"/source/"}