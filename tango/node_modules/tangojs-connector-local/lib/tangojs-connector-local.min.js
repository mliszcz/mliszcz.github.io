!function(e,t){if("function"==typeof define&&define.amd)define(["exports","tangojs"],t);else if("undefined"!=typeof exports)t(exports,require("tangojs"));else{var n={exports:{}};t(n.exports,e.tangojs),e.tangojsConnectorLocal=n.exports}}(this,function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(){return(new Date).getTime()}function i(e){return Promise.reject(new Error(e))}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,u=n;a=c=s=void 0,r=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var s=a.get;return void 0===s?void 0:s.call(u)}var c=Object.getPrototypeOf(o);if(null===c)return void 0;e=c,t=i,n=u,r=!0}},c=function(e){function c(e){n(this,c),s(Object.getPrototypeOf(c.prototype),"constructor",this).call(this),this._model=e}return r(c,e),a(c,[{key:"_devicePromise",value:function(e){try{var t=e.split("/"),n=u(t,3),r=n[0],o=n[1],a=n[2];return Promise.resolve(this._model[r][o][a])}catch(s){return i("Invalid device name: '"+e+"'")}}},{key:"_attributePromise",value:function(e,t){return this._devicePromise(e).then(function(n){return n.attributes&&n.attributes[t]?n.attributes[t]:i("Attribute not found: '"+e+"/"+t+"'")})}},{key:"_commandPromise",value:function(e,t){return this._devicePromise(e).then(function(n){return n.commands&&n.commands[t]?n.commands[t]:i("Command not found: '"+e+"/"+t+"'")})}},{key:"dbReadDomains",value:function(){return this._model?Promise.resolve(Object.keys(this._model)):Promise.reject(new Error("Invalid model"))}},{key:"dbReadFamilies",value:function(e){return this._model&&this._model[e]?Promise.resolve(Object.keys(this._model[e])):Promise.reject(new Error("Invalid domain: '"+e+"'"))}},{key:"dbReadMembers",value:function(e,t){return this._model&&this._model[e]&&this._model[e][t]?Promise.resolve(Object.keys(this._model[e][t])):Promise.reject(new Error("Invalid domain: '"+e+"' or family: '"+t+"'"))}},{key:"readDeviceStatus",value:function(e){return this._devicePromise(e).then(function(e){var n=e.status(),r=u(n,2),i=r[0],a=r[1];return new t.DeviceStatusResponse(o(),i,a)})}},{key:"readDeviceInfo",value:function(e){return this._devicePromise(e).then(function(e){return new t.DeviceInfo(e.info())})}},{key:"readAttributesList",value:function(e){return this._devicePromise(e).then(function(e){return Object.keys(e.attributes)})}},{key:"readAttributeValue",value:function(e,n){return this._attributePromise(e,n).then(function(e){return new t.AttributeReadResponse(o(),e.read(),t.AttributeQuality.ATTR_VALID)})}},{key:"writeAttributeValuesBulk",value:function(e,n){var r=this,i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],a=arguments.length<=3||void 0===arguments[3]?!1:arguments[3],s=n.map(function(t){var n=u(t,2),o=n[0],i=n[1];return r._attributePromise(e,o).then(function(e){return[e,i]})}),c=t.AttributeQuality.ATTR_VALID,f=function(e){return e.map(function(e){var t=u(e,2),n=t[0],r=t[1];return[n,n.write(r)]}).map(function(e){var n=u(e,1),r=n[0];return i?new t.AttributeReadResponse(o(),r.read(),c):void 0})},l=n.map(function(e){var t=u(e,1),n=t[0];return n}),m=a?function(t){return r.readAttributesList(e).then(function(n){var o=n.filter(function(e){return!(e in l)}).map(function(t){return r._attributePromise(e,t)});return Promise.all(o).then(function(e){return e.forEach(function(e){return e.reset()})}).then(function(){return t})})}:function(e){return e};return Promise.all(s).then(f).then(m)}},{key:"readAttributeInfo",value:function(e,n){return this._attributePromise(e,n).then(function(e){return new t.AttributeInfo(e.info())})}},{key:"readCommandsList",value:function(e){return this._devicePromise(e).then(function(e){return Object.keys(e.commands)})}},{key:"readCommandInfo",value:function(e,n){return this._commandPromise(e,n).then(function(e){return new t.CommandInfo(e.info())})}},{key:"executeCommand",value:function(e,n,r,i){return this._commandPromise(e,n).then(function(e){var n=e.execute(r);return i?new t.CommandOutputResponse(o(),n):void 0})}}]),c}(t.Connector);e.LocalConnector=c});
//# sourceMappingURL=tangojs-connector-local.min.js.map